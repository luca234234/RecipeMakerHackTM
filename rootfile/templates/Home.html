<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/rootfile/static/main.css" />
    <title>Recipe Now</title>
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg bg-body-tertiary fixed-top justify-content-center"
    >
      <div class=" container-fluid d-flex justify-content-center">
        <div class="background-transparent w-auto title-text rounded-pill ps-3 pe-3 pt-1 pb-1">
                Please take a picture of the food
        </div>
      </div>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav"></ul>
      </div>
    </nav>
    <video id="video" autoplay class="position-fixed w-100 h-100"></video>

    <footer class="fixed-footer">
      <div class="d-flex justify-content-center">
        <div class="text-center bottom-bar camera-button">
          <button id="snap" class="inner-circle" onclick="TakePhoto()"></button>
        </div>
      </div>
    </footer>

    <div
      id="loading"
      style="display: none; z-index: 2000"
      class="position-absolute w-100 h-100 text-center"
    >
      <img src="/rootfile/static/loading.gif" />
    </div>

    <script>
      function TakePhoto() {
        var loadingDiv = document.getElementById("loading");
        var showLoadingBtn = document.getElementById("showLoadingBtn");

        loadingDiv.style.display = "block";
        context.drawImage(video, 0, 0, 640, 480);

        document.getElementById("navbar").style.display = "none";
        // Send the image data to the server
        fetch("/predict", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ image: imageData }),
        });
      }

      const constraints = {
        audio: false,
        video: {
          facingMode: "environment", // Use the rear camera if available
        },
      };

      // Get access to the camera!
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function (stream) {
            // Video is streamed to the video element
            let video = document.getElementById("video");
            video.srcObject = stream;
            video.play();

            // Elements for taking the snapshot
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
          })
          .catch(function (err) {
            console.log(err.name + ": " + err.message);
          }); // Always check for errors at the end.
      }
    </script>
  </body>
</html>
